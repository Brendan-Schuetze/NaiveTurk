# Clean input
def cleanInput(input):
    input = input.toUpper()
    input = re.sub("{|}", "", input).replace('"',"")

# Password Hashing Function
def hashKey(key):
    hash = bcrypt.generate_password_hash(key)
    return(hash)

# Helper Function for Generating Hashes and Inserting into DB
def createKeySet(public_key, private_key, first_name, last_name, email_address):
    hash = hashKey(private_key)

    existing = mongo.db.keys.find_one({"public_key": public_key})
    existing_email = mongo.db.keys.find_one({"email_address": email_address})
    if existing is not None or existing_email is not None:
        return("Username or email is already taken.")
    else:
        mongo.db.keys.insert({"public_key": public_key, "hash": hash,
            "registered_on": strftime("%Y-%m-%d %H:%M:%S",
            gmtime()), "verified": "False",
            "first_name": first_name, "last_name": last_name,
            "email_address": email_address})
        return("Success.")

def digest(user):
    user = hashlib.sha256(user + "nvt.science").hexdigest()
    return(user)

# Find Worker
def findWorker(user):
    return(mongo.db.id.find_one({"worker": digest(user)}))

# Ping Worker
def pingWorker(user_doc):
    id = user_doc["_id"]
    mongo.db.id.update({ "_id" : id},
        { "$push": { "pings": strftime("%Y-%m-%d %H:%M:%S", gmtime()) }})
    return(id)

# Update Worker Tags
def pingTag(id, tag):
    return(True)

def redirect_url(default='index'):
    return request.args.get('next') or \
           request.referrer or \
           url_for(default)
